<!doctype html><html lang=en>
<head>
<title>Don't Amend, Fix - tamir.dev</title>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=description content="Kiera: A Hugo theme for creative and technical writing.">
<meta name=author content="Tamir Bahar"><meta property="og:title" content="Don't Amend, Fix">
<meta property="og:description" content="A fun alternative to `git commit --amend`">
<meta property="og:type" content="article">
<meta property="og:url" content="https://www.example.org/posts/dont-amend-fix/"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2017-03-10T00:00:00+00:00">
<meta property="article:modified_time" content="2017-03-10T00:00:00+00:00">
<meta name=twitter:card content="summary">
<meta name=twitter:title content="Don't Amend, Fix">
<meta name=twitter:description content="A fun alternative to `git commit --amend`">
<meta name=generator content="Hugo 0.89.0">
<link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css integrity="sha256-l85OmPOjvil/SOvVt3HnSSjzF1TUMyT9eV0c2BzEGzU=" crossorigin=anonymous>
<link rel=stylesheet href=https://www.example.org/fontawesome/css/all.min.css>
<link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto+Slab|Ruda">
<link rel=stylesheet type=text/css href=https://www.example.org/css/styles.css></head>
<body>
<div id=container>
<header>
<h1>
<a href=https://www.example.org/>tamir.dev</a>
</h1>
<ul id=social-media>
<li>
<a href=https://github.com/tmr232 title=GitHub>
<i class="fab fa-github fa-lg"></i>
</a>
</li>
<li>
<a href=https://twitter.com/tmr232 title=Twitter>
<i class="fab fa-twitter fa-lg"></i>
</a>
</li>
<li>
<a href=https://stackoverflow.com/tmr232 title=StackOverflow>
<i class="fab fa-stack-overflow fa-lg"></i>
</a>
</li>
<li>
<a href=https://dev.to/tmr232 title=devto>
<i class="fab fa-dev fa-lg"></i>
</a>
</li>
</ul>
<p><em>A Hugo theme for creative and technical writing</em></p>
</header>
<nav>
<ul>
</ul>
</nav>
<main>
<article>
<h1>Don't Amend, Fix</h1>
<aside>
<ul>
<li>
<time class=post-date datetime=2017-03-10T00:00:00Z>Mar 10, 2017</time>
</li>
<li>
Categories:
<em>
<a href=https://www.example.org/categories/git>git</a>
</em>
</li>
<li>3 minute read</li>
</ul>
</aside>
<p>As git users, we know that we should &ldquo;commit early, commit often.&rdquo; While this is a wonderful thing to do, it does mean that from time to time we make a mistake and need to fix a commit. Maybe we forget to <code>git add</code> a new file, or missed a typo. So we go ahead and <code>git commit --amend</code>. Problem solved. Great.</p>
<p>But personally, I hate it.</p>
<p>For one thing, amending commits hides history. Once you amend, that past state is gone before you can properly test the new one. True, you can also restore it via <code>git reflog</code>, but no-one really likes using that. It should be a last resort.</p>
<p>For another thing, amending is very limited. Say I am writing some C code. I write my first module, add it and commit.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>git add FirstModule.h
git commit -m <span style=color:#e6db74>&#34;Added FirstModule&#34;</span>
</code></pre></div><p>I write my second module, and add it as well.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>git add SecondModule.h SecondModule.c
git commit -m <span style=color:#e6db74>&#34;Added SecondModule&#34;</span>
</code></pre></div><p>And now, after adding that second commit, I realize that I forgot to commit <code>FirstModule.c</code>. <code>git commit --amend</code> to the rescue? Not really. I now have to resort to the black, frightening voodoo magic called <code>git rebase</code>.</p>
<p>First, we commit the forgotten module</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>git add FirstModule.c
git commit -m <span style=color:#e6db74>&#34;Added FirstModule.c, forgotten eariler.&#34;</span>
</code></pre></div><p>And then rebase - <code>git rebase -i HEAD~3</code></p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>pick 1db8687 Added FirstModule
pick 336941b Added SecondModule
pick 7884909 Added FirstModule.c, forgotten eariler.
</code></pre></div><p>Change to</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>pick 1db8687 Added FirstModule
fixup 7884909 Added FirstModule.c, forgotten eariler.
pick 336941b Added SecondModule
</code></pre></div><p>Save & Quit, and we&rsquo;re done.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>* 1946e37d105ffebcbd91bb958f8a2fce6160c761 (HEAD -&gt; master) Added SecondModule
|  create mode 100644 SecondModule.c
|  create mode 100644 SecondModule.h
* 8ffbb9f2915e060a6c4771e13f5a82442743724c Added FirstModule
|  create mode 100644 FirstModule.c
|  create mode 100644 FirstModule.h
* 815e7bab6ee1fa5bf1df10f5705919b48cbe214c First Commit
</code></pre></div><p>Not that hard, is it?</p>
<p>But still, moving between amending and rebasing can be cumbersome. Especially as most of the time there is no real need to rebase and it&rsquo;s easy to forget the process. Enter <code>git commit --fixup</code> (or <code>--squash</code>) and <code>git rebase -i --autosquash</code>.</p>
<p>These commands save us the work of reordering the commits and changing from <code>pick</code> to <code>fixup</code> or <code>squash</code>. Making our rebasing work a lot easier.</p>
<p>I like defining the following aliases:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ini data-lang=ini><span style=color:#66d9ef>[alias]</span>
    <span style=color:#a6e22e>ri</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>rebase -i --autosquash
</span><span style=color:#e6db74>    mri = rebase -i
</span><span style=color:#e6db74>    fix = commit --fixup
</span><span style=color:#e6db74>    squ = commit --squash</span>
</code></pre></div><p>Using those aliases, the rebasing we did earlier would work as follows:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>git add FirstModule.c
git fix HEAD~1
git ri HEAD~3
</code></pre></div><p>We&rsquo;d get the following rebase automatically</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>pick 1db8687 Added FirstModule
fixup 50a3650 fixup! Added FirstModule
pick 336941b Added SecondModule
</code></pre></div><p>Exit the editor, and be done with it.</p>
<p>We can use <code>fix</code> as many times as we want (just go ahead and <code>git fix HEAD -a</code>) before the rebase. Our log may look funny</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>* fe0c2a0 (HEAD -&gt; master) fixup! fixup! fixup! fixup! Added SecondModule
* a53cd32 fixup! fixup! fixup! Added SecondModule
* 9c19f2d fixup! fixup! Added SecondModule
* b758a53 fixup! Added SecondModule
* 902d65e Added SecondModule
* 67f1260 Added FirstModule
* 815e7ba First Commit
</code></pre></div><p>But the rebase doesn&rsquo;t care</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>pick 902d65e Added SecondModule
fixup b758a53 fixup! Added SecondModule
fixup 9c19f2d fixup! fixup! Added SecondModule
fixup a53cd32 fixup! fixup! fixup! Added SecondModule
fixup fe0c2a0 fixup! fixup! fixup! fixup! Added SecondModule
</code></pre></div><h2 id=conclusion>Conclusion</h2>
<p>Stop using <code>git commit --amend</code> and start using <code>git fix</code> (<code>git commit --fixup</code>) instead. It is a no-fear, low-overhead alternative, and it far more flexible.
Here are the aliases again, in case you want them:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ini data-lang=ini><span style=color:#66d9ef>[alias]</span>
    <span style=color:#a6e22e>ri</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>rebase -i --autosquash
</span><span style=color:#e6db74>    mri = rebase -i
</span><span style=color:#e6db74>    fix = commit --fixup
</span><span style=color:#e6db74>    squ = commit --squash</span>
</code></pre></div>
</article>
<section class=post-nav>
<ul>
<li>
</li>
<li>
<a href=https://www.example.org/posts/the-windows-cli-sucks-and-thats-good/>The Windows CLI sucks, and that's good. <i class="fa fa-chevron-circle-right"></i> </a>
</li>
</ul>
</section>
</main>
<footer>
<ul>
<li>
<h6>Copyright Â© 2021 - Tamir Bahar |
Rendered by <a href=https://gohugo.io title=Hugo>Hugo</a> |
<a href=https://www.example.org/index.xml>Subscribe </a></h6>
</li>
</ul>
</footer>
</div>
<script src=https://www.example.org/js/scripts.js></script>
</body>
</html>