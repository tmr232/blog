<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Visualizing Code in CFGs | Tamir Bahar</title><meta name=keywords content><meta name=description content="Overview of the visualization used in function-graph-overview"><meta name=author content="Tamir Bahar"><link rel=canonical href=https://tamir.dev/posts/cfg-visualization-legend/><link crossorigin=anonymous href=/assets/css/stylesheet.0b7a6a59f13c612205962144f1a8f43a859c4d814d43709a9e3e2b0e9353224b.css integrity="sha256-C3pqWfE8YSIFliFE8aj0OoWcTYFNQ3Canj4rDpNTIks=" rel="preload stylesheet" as=style><link rel=icon href=https://tamir.dev/images/profilepic.jpg><link rel=icon type=image/png sizes=16x16 href=https://tamir.dev/images/profilepic.jpg><link rel=icon type=image/png sizes=32x32 href=https://tamir.dev/images/profilepic.jpg><link rel=apple-touch-icon href=https://tamir.dev/images/profilepic.jpg><link rel=mask-icon href=https://tamir.dev/images/profilepic.jpg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=webmention href=https://webmention.io/tamir.dev/webmention><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="Visualizing Code in CFGs"><meta property="og:description" content="Overview of the visualization used in function-graph-overview"><meta property="og:type" content="article"><meta property="og:url" content="https://tamir.dev/posts/cfg-visualization-legend/"><meta property="og:image" content="https://tamir.dev/images/profilepic.jpg"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-10-06T00:00:00+00:00"><meta property="article:modified_time" content="2024-10-06T00:00:00+00:00"><meta property="og:site_name" content="Tamir Bahar"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://tamir.dev/images/profilepic.jpg"><meta name=twitter:title content="Visualizing Code in CFGs"><meta name=twitter:description content="Overview of the visualization used in function-graph-overview"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://tamir.dev/posts/"},{"@type":"ListItem","position":2,"name":"Visualizing Code in CFGs","item":"https://tamir.dev/posts/cfg-visualization-legend/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Visualizing Code in CFGs","name":"Visualizing Code in CFGs","description":"Overview of the visualization used in function-graph-overview","keywords":[],"articleBody":"Over the last few weeks I‚Äôve been working on a VSCode extension for visualizing the control-flow-graph (CFG) for the function you‚Äôre reading.\nIf you want, you can play with the live demo, install the extnsion, or look at the code.\nWhile some choices for the visualization are rather straightforward, some are not. So I want to go over the choices I made and the reasoning for them.\nBasic Control Flow First - to represent a block of code, we use a block. The more code we have in the block, the taller the block will become. This helps give a basic sense of ‚Äúhow much code is there?‚Äù\nNext, to connect two blocks we use arrows. The default color is blue. Since the graph can get quite large, we mark the entry-point in green and all the exits (return statements, mostly) in red. Then we have conditions (if). We use green for the consequence branch (when the condition holds) and red for the alternative (when the condition evaluates to false). For switch statements, we have two possible representations: chained-ifs, or flat. Since both have their benefits, choosing between them is a configurable option.\nChained Flat For loops we use the same structures we used before. Green for the consequence, leading us into the loop body; red for the alternative case, leaving the loop. You might notice that the arrow pointing back to the top of the loop has a thicker line. We make all back-linking arrows thicker so that they are easily distinguished from other arrows, as they are structurally distinct.\nThese are the basic blocks of our graph, showing the flow of the program. But there are some structures that break the flow of the code.\nExceptions \u0026 Context Managers While most control-flow structures translate well to graphs, exceptions are an exception. Since every line of code can potentially raise an exception, drawing all the arrows would make the graph entirely unreadable. Instead, we use clusters. We surround the entire try-except-else-finally construct with a pale-blue background to let us know everything within it is part of the same thing. For the try block we use a green background, letting us know that this is the ‚Äúhappy path‚Äù. except blocks are separately surrounded by pale-red backgrounds, letting us know that they can be reached separately.\nThe else block, if present, is placed in the surrounding blue background. This separates it clearly from the try block, letting us know that exceptions from it are not handled in this blue cluster. Then, with finally, things get a little tricky. In a simple case, we just give it a yellow background and call it a day. But it‚Äôs interaction with return statements in the preceding blocks can result in interesting flows.\nBelow, we have the flow for a try-except block, where the except clause returns from the function. Next to it, we have the same structure if a finally clause is added:\ntry-except(return) try-except(return)-finally In this case, there are 2 separate flows out of the try-... block. To keep them separate, we duplicate the finally block for every flow. While this is useful, it can get a bit crazy when the finally block has logic inside it: Context Managers The with statement gets a similar treatment, this time with a light-fuschia background: When nested, we also add a white border to separate the levels. The same border technique is used for exceptions as well. Special Nodes In addition to the function entry-point and return statements, raise and yield also get special treatment:\nraise statements get a triangle in the same color as the except blocks. The triangle is meant to be similar to the ‚Äúhouse‚Äù shape of return nodes, while the color is meant to clarify the connection to except.\nyield gets a hexagonal shape, conceptually the combination of the exit and entry node shapes (as you both leave and entry the function through the yield statement), and the color is light-blue, making it distinct from other nodes in the graph.\n","wordCount":"668","inLanguage":"en","datePublished":"2024-10-06T00:00:00Z","dateModified":"2024-10-06T00:00:00Z","author":{"@type":"Person","name":"Tamir Bahar"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://tamir.dev/posts/cfg-visualization-legend/"},"publisher":{"@type":"Organization","name":"Tamir Bahar","logo":{"@type":"ImageObject","url":"https://tamir.dev/images/profilepic.jpg"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://tamir.dev/ accesskey=h title="Tamir Bahar (Alt + H)">Tamir Bahar</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://tamir.dev/blogvent/ title=blogventüéÑ><span>blogventüéÑ</span></a></li><li><a href=https://tamir.dev/posts/ title=posts><span>posts</span></a></li><li><a href=https://tamir.dev/archives/ title=archives><span>archives</span></a></li><li><a href=https://tamir.dev/index.xml title=rss><span>rss</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" height="13"><g transform="scale(1)"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></g></svg></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://tamir.dev/>Home</a>&nbsp;¬ª&nbsp;<a href=https://tamir.dev/posts/>Posts</a></div><h1 class=post-title>Visualizing Code in CFGs</h1><div class=post-description>Overview of the visualization used in function-graph-overview</div><div class=post-meta><span title='2024-10-06 00:00:00 +0000 UTC'>Oct 6, 2024</span>&nbsp;¬∑&nbsp;Tamir Bahar</div></header><div class=post-content><p>Over the last few weeks I&rsquo;ve been working on a VSCode extension for visualizing the control-flow-graph (CFG) for the function you&rsquo;re reading.</p><p>If you want, you can <a href=https://tmr232.github.io/function-graph-overview/>play with the live demo</a>, <a href="https://marketplace.visualstudio.com/items?itemName=tamir-bahar.function-graph-overview">install the extnsion</a>, or <a href=https://github.com/tmr232/function-graph-overview/>look at the code</a>.</p><p>While some choices for the visualization are rather straightforward, some are not.
So I want to go over the choices I made and the reasoning for them.</p><h2 id=basic-control-flow><a href=#basic-control-flow>Basic Control Flow<span hidden class=anchor aria-hidden=true href=#basic-control-flow>#</span></a></h2><p>First - to represent a block of code, we use a block.
<img src=attachment/2747e4ef36faf2935b18c2c27381e031.svg alt></p><p>The more code we have in the block, the taller the block will become.
<img src=attachment/91149e34d9b7410d32abea75fba48a27.svg alt></p><p>This helps give a basic sense of &ldquo;how much code is there?&rdquo;</p><p>Next, to connect two blocks we use arrows.
The default color is blue.
<img src=attachment/d906768ff9fd5c44af90c575f6e5710e.svg alt></p><p>Since the graph can get quite large, we mark the entry-point in green and all the exits (<code>return</code> statements, mostly) in red.
<img src=attachment/333b7cced3421ae9407227f382b4fc4c.svg alt></p><p>Then we have conditions (<code>if</code>).
We use green for the consequence branch (when the condition holds) and red for the alternative (when the condition evaluates to <code>false</code>).
<img src=attachment/07a7e4fc2331daba1fd97000788110e3.svg alt></p><p>For <code>switch</code> statements, we have two possible representations: chained-ifs, or flat.
Since both have their benefits, choosing between them is a configurable option.</p><table><thead><tr><th>Chained</th><th>Flat</th></tr></thead><tbody><tr><td><img src=attachment/d41a8a15e5c66732f25235d6121bdeaf.svg alt></td><td><img src=attachment/e9839f50ce548c8b569328c8a86a4a65.svg alt></td></tr></tbody></table><p>For loops we use the same structures we used before.
Green for the consequence, leading us into the loop body; red for the alternative case, leaving the loop.
<img src=attachment/dc1c0c17cbdf8ff5ebdea4d8fe6fd7b3.svg alt></p><p>You might notice that the arrow pointing back to the top of the loop has a thicker line.
We make all back-linking arrows thicker so that they are easily distinguished from other arrows, as they are structurally distinct.</p><p>These are the basic blocks of our graph, showing the flow of the program.
But there are some structures that break the flow of the code.</p><h2 id=exceptions--context-managers><a href=#exceptions--context-managers>Exceptions & Context Managers<span hidden class=anchor aria-hidden=true href=#exceptions--context-managers>#</span></a></h2><p>While most control-flow structures translate well to graphs, exceptions are an exception.
Since every line of code can potentially raise an exception, drawing all the arrows would make the graph entirely unreadable.
Instead, we use clusters.
<img src=attachment/c79b00b3962f62d032a3c58993c7fa0e.svg alt></p><p>We surround the entire <code>try-except-else-finally</code> construct with a pale-blue background to let us know everything within it is part of the same thing.
For the <code>try</code> block we use a green background, letting us know that this is the &ldquo;happy path&rdquo;.
<code>except</code> blocks are separately surrounded by pale-red backgrounds, letting us know that they can be reached separately.</p><p>The <code>else</code> block, if present, is placed in the surrounding blue background.
This separates it clearly from the <code>try</code> block, letting us know that exceptions from it are <em>not</em> handled in this blue cluster.
<img src=attachment/d6319324bd36187204307ee4dd6923f9.svg alt></p><p>Then, with <code>finally</code>, things get a little tricky.
In a simple case, we just give it a yellow background and call it a day.
<img src=attachment/ed3ae990a6875f50e135348c170f5b26.svg alt></p><p>But it&rsquo;s interaction with <code>return</code> statements in the preceding blocks can result in interesting flows.</p><p>Below, we have the flow for a <code>try-except</code> block, where the <code>except</code> clause returns from the function.
Next to it, we have the same structure if a <code>finally</code> clause is added:</p><table><thead><tr><th><code>try-except(return)</code></th><th><code>try-except(return)-finally</code></th></tr></thead><tbody><tr><td><img src=attachment/9ae04b3856c858d0d79482fc2ec82512.svg alt></td><td><img src=attachment/b726ecc956fa25b4ddcbc887cff9b207.svg alt></td></tr></tbody></table><p>In this case, there are 2 separate flows out of the <code>try-...</code> block.
To keep them separate, we duplicate the <code>finally</code> block for every flow.
While this is useful, it can get a bit crazy when the <code>finally</code> block has logic inside it:
<img src=attachment/3f4033e1b6cc8c99e8f65186b2f9fedf.svg alt></p><h3 id=context-managers><a href=#context-managers>Context Managers<span hidden class=anchor aria-hidden=true href=#context-managers>#</span></a></h3><p>The <code>with</code> statement gets a similar treatment, this time with a light-fuschia background:
<img src=attachment/22c07620ed8c9d256ab17d9cdb23ba1b.svg alt></p><p>When nested, we also add a white border to separate the levels.
The same border technique is used for exceptions as well.
<img src=attachment/73bca51fb0b540a4c0e32cc4427d1f4b.svg alt></p><h2 id=special-nodes><a href=#special-nodes>Special Nodes<span hidden class=anchor aria-hidden=true href=#special-nodes>#</span></a></h2><p>In addition to the function entry-point and <code>return</code> statements, <code>raise</code> and <code>yield</code> also get special treatment:</p><p><img src=attachment/14d2ed924154bfc8bbf3412f2d7abf10.svg alt>
<code>raise</code> statements get a triangle in the same color as the <code>except</code> blocks.
The triangle is meant to be similar to the &ldquo;house&rdquo; shape of <code>return</code> nodes, while the color is meant to clarify the connection to <code>except</code>.</p><p><code>yield</code> gets a hexagonal shape, conceptually the combination of the exit and entry node shapes (as you both leave and entry the function through the <code>yield</code> statement), and the color is light-blue, making it distinct from other nodes in the graph.</p></div><footer class=post-footer><ul class=post-tags></ul><div style=display:flex;justify-content:center class=discuss><a href=https://github.com/tmr232/tamir.dev/discussions/13 target=_blank rel="noopener noreferrer me" title="Discuss this post">Discuss this post<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" height="1em" style="margin-bottom:-.2em;margin-left:.2em"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a></div></footer></article></main><footer class=footer><span>&copy; 2024 <a href=https://tamir.dev/>Tamir Bahar</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>